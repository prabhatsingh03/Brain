{% extends "base.html" %}

{% block content %}
<script>
    document.body.classList.add('dashboard-mode');
</script>

<div class="space-y-8">
    <!-- Header -->
    <div class="flex justify-between items-end border-b border-slate-200 dark:border-gray-800 pb-4">
        <div>
            <h1 class="text-3xl md:text-4xl font-display font-bold text-gray-900 dark:text-white mb-2 tracking-tight">
                Process Hub</h1>
            <p class="text-textSoft text-lg">Select a plant process to interact with the AI brain.</p>
        </div>

        <div class="flex items-center gap-3">
            {% if current_user.is_authenticated %}
            {% include 'partials/user_dropdown.html' %}
            {% endif %}
        </div>
    </div>

    <!-- Grid of processes (Knowledge Hub) -->
    <div id="projects-section" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {% for project in projects %}
        <a href="{{ url_for('main.project_view', project_name=project.name) }}"
            class="crazy-card group block rounded-2xl p-6 relative transition-all duration-300"
            style="--mouse-x: 50%; --mouse-y: 50%;">

            <div class="crazy-card-content">
                <div class="flex justify-between items-start mb-4">
                    <!-- Icon -->
                    <div
                        class="crazy-card-icon-wrapper p-3 bg-accent/10 rounded-xl text-accent transition-colors duration-300 ring-1 ring-white/5">
                        {% if 'SAP' in project.name|upper %}
                        <!-- SAP Icon (Cyber Server) -->
                        <svg class="w-12 h-12 crazy-icon-svg crazy-icon-sap" viewBox="0 0 100 100" fill="none"
                            stroke="currentColor">
                            <!-- Base Base -->
                            <path class="icon-floater" d="M20 70 L50 85 L80 70 L80 40 L50 25 L20 40 Z" stroke-width="2"
                                fill="rgba(244, 114, 182, 0.1)" />
                            <path class="icon-floater" d="M50 85 L50 55 M20 40 L50 55 L80 40" stroke-width="2" />
                            <!-- Orbiting Data Rings -->
                            <circle class="icon-ring" cx="50" cy="40" r="30" stroke-width="2" stroke-dasharray="10 5"
                                opacity="0.6" />
                            <circle class="icon-ring-reverse" cx="50" cy="40" r="22" stroke-width="1.5"
                                stroke-dasharray="4 4" opacity="0.8" />
                            <!-- Floating Bits -->
                            <circle class="icon-blink" cx="30" cy="30" r="3" fill="currentColor" />
                            <circle class="icon-blink" cx="70" cy="50" r="3" fill="currentColor"
                                style="animation-delay: 1s;" />
                        </svg>
                        {% elif 'DAP' in project.name|upper %}
                        <!-- DAP Icon (Neural Graph) -->
                        <svg class="w-12 h-12 crazy-icon-svg crazy-icon-dap" viewBox="0 0 100 100" fill="none"
                            stroke="currentColor">
                            <!-- Central Hub -->
                            <circle class="icon-core" cx="50" cy="50" r="12" stroke-width="3"
                                fill="rgba(46, 230, 255, 0.2)" />
                            <!-- Nodes -->
                            <g class="icon-ring">
                                <circle cx="50" cy="15" r="5" fill="currentColor" />
                                <circle cx="85" cy="50" r="5" fill="currentColor" />
                                <circle cx="50" cy="85" r="5" fill="currentColor" />
                                <circle cx="15" cy="50" r="5" fill="currentColor" />
                                <!-- Connections -->
                                <path d="M50 20 L50 40 M80 50 L60 50 M50 80 L50 60 M20 50 L40 50" stroke-width="2" />
                            </g>
                            <!-- Outer Scanner -->
                            <path class="icon-ring-reverse" d="M15 15 L85 85" stroke-width="2" stroke-dasharray="2 4"
                                opacity="0.5" />
                            <path class="icon-ring-reverse" d="M85 15 L15 85" stroke-width="2" stroke-dasharray="2 4"
                                opacity="0.5" />
                        </svg>
                        {% elif 'PAP' in project.name|upper %}
                        <!-- PAP Icon (Hyper Gears) -->
                        <svg class="w-12 h-12 crazy-icon-svg crazy-icon-pap" viewBox="0 0 100 100" fill="none"
                            stroke="currentColor">
                            <!-- Outer Gear -->
                            <g class="icon-ring">
                                <path
                                    d="M50 10 L55 20 L65 20 L70 30 L80 32 L82 42 L90 50 L82 58 L80 68 L70 70 L65 80 L55 80 L50 90 L45 80 L35 80 L30 70 L20 68 L18 58 L10 50 L18 42 L20 32 L30 30 L35 20 L45 20 Z"
                                    stroke-width="2" />
                                <circle cx="50" cy="50" r="25" stroke-width="2" />
                            </g>
                            <!-- Inner Gear -->
                            <g class="icon-ring-reverse" style="animation-duration: 8s;">
                                <path
                                    d="M50 35 L55 40 L60 40 L65 50 L60 60 L55 60 L50 65 L45 60 L40 60 L35 50 L40 40 L45 40 Z"
                                    fill="currentColor" opacity="0.6" />
                            </g>
                        </svg>
                        {% elif 'AMONIA' in project.name|upper or 'AMMONIA' in project.name|upper %}
                        <!-- Ammonia Icon (Atomic Spin) -->
                        <svg class="w-12 h-12 crazy-icon-svg crazy-icon-ammonia" viewBox="0 0 100 100" fill="none"
                            stroke="currentColor">
                            <!-- Nucleus -->
                            <circle class="icon-core" cx="50" cy="50" r="10" fill="currentColor" />
                            <!-- Orbits -->
                            <ellipse class="icon-ring" cx="50" cy="50" rx="40" ry="12" stroke-width="2" />
                            <ellipse class="icon-ring" cx="50" cy="50" rx="40" ry="12" stroke-width="2"
                                style="transform: rotate(60deg);" />
                            <ellipse class="icon-ring" cx="50" cy="50" rx="40" ry="12" stroke-width="2"
                                style="transform: rotate(120deg);" />
                            <!-- Electrons -->
                            <circle class="icon-floater" cx="90" cy="50" r="5" fill="currentColor" />
                            <circle class="icon-floater" cx="30" cy="15" r="5" fill="currentColor"
                                style="animation-delay: 1s;" />
                            <circle class="icon-floater" cx="30" cy="85" r="5" fill="currentColor"
                                style="animation-delay: 2s;" />
                        </svg>
                        {% else %}
                        <!-- Default Process Icon (AI Chip) -->
                        <svg class="w-12 h-12 crazy-icon-svg text-accent" viewBox="0 0 100 100" fill="none"
                            stroke="currentColor">
                            <rect class="icon-floater" x="25" y="25" width="50" height="50" rx="10" stroke-width="3"
                                fill="rgba(109, 93, 252, 0.1)" />
                            <path class="icon-core" d="M35 50 L45 60 L65 40" stroke-width="4" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <!-- Pins -->
                            <path
                                d="M25 35 H15 M25 50 H15 M25 65 H15 M75 35 H85 M75 50 H85 M75 65 H85 M35 25 V15 M50 25 V15 M65 25 V15 M35 75 V85 M50 75 V85 M65 75 V85"
                                stroke-width="2" opacity="0.6" />
                            <circle class="icon-blink" cx="85" cy="35" r="3" fill="currentColor" />
                        </svg>
                        {% endif %}
                    </div>
                    <!-- Live Pulse -->
                    <span class="live-indicator">
                        <span class="flex h-3 w-3 relative">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500 box-shadow-glow"></span>
                        </span>
                        <span class="live-text-label">LIVE</span>
                    </span>
                </div>

                <div class="flex items-center justify-between mb-2">
                    <h3
                        class="text-xl font-display font-bold text-gray-900 dark:text-white neon-text tracking-wide group-hover:text-accent transition-colors">
                        {{ project.name }}</h3>
                    <!-- Simple Sparkline SVG -->
                    <svg class="w-16 h-8 text-accent crazy-sparkline" viewBox="0 0 50 20" fill="none"
                        stroke="currentColor">
                        <path d="M0 10 Q 5 15, 10 5 T 20 10 T 30 15 T 40 5 T 50 12" stroke-width="2"
                            stroke-linecap="round" />
                    </svg>
                </div>

                <p
                    class="text-sm text-gray-600 dark:text-textSoft line-clamp-2 mb-4 group-hover:text-gray-800 dark:group-hover:text-white/80 transition-colors">
                    {{
                    project.description }}</p>

                <div class="flex gap-2 mt-4 opacity-70 group-hover:opacity-100 transition-opacity">
                    <span
                        class="text-[10px] bg-white dark:bg-primary/80 px-2 py-1 rounded border border-slate-300 dark:border-gray-700 text-accent font-mono">700+
                        DOCS</span>
                    <span
                        class="text-[10px] bg-white dark:bg-primary/80 px-2 py-1 rounded border border-slate-300 dark:border-gray-700 text-green-400 dark:text-green-400 font-mono ai-active-badge">AI-ACTIVE</span>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    {% if not projects %}
    <div
        class="text-center py-20 bg-white dark:bg-secondary rounded-xl border border-dashed border-slate-300 dark:border-gray-700">
        <p class="text-textSoft">No projects found. Please contact admin to initialize the database.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const cards = document.querySelectorAll('.crazy-card');

        cards.forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left; // x position within the element.
                const y = e.clientY - rect.top;  // y position within the element.

                // Update CSS variables for glow effects
                card.style.setProperty('--mouse-x', `${x}px`);
                card.style.setProperty('--mouse-y', `${y}px`);

                // 3D Tilt Logic
                // Range: -10deg to 10deg
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                const rotateX = ((y - centerY) / centerY) * -5; // Invert axis
                const rotateY = ((x - centerX) / centerX) * 5;

                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
            });

            card.addEventListener('mouseleave', () => {
                // Reset styling
                card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)';
            });
        });
    });
</script>
{% endblock %}